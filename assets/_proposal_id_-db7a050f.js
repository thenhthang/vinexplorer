import{d as tt,j as S,I as et,Z as st,a2 as ot,Y as at,m as nt,ag as lt,a1 as d,a8 as it,o as _,n as v,p as e,t as a,L as N,q as i,M as T,H as $,F as C,s as U,ah as rt,y as ut,Q as k,K as ct}from"./index-81fd55b5.js";import{b as dt,W as _t}from"./index-66d6f781.js";import{_ as j}from"./Countdown.vue_vue_type_style_index_0_lang-d0fa6066.js";import{_ as vt}from"./PaginationBar.vue_vue_type_script_setup_true_lang-37ee17a0.js";import"./index-9219bdf5.js";const mt={class:"bg-base-100 px-4 pt-3 pb-4 rounded mb-4 shadow"},pt={class:"card-title flex flex-col md:!justify-between md:!flex-row"},ht={class:"truncate w-full"},bt={class:""},ft={key:0},gt={class:"gap-4 mb-4 grid lg:!!grid-cols-3 auto-rows-max"},yt={class:"bg-base-100 px-4 pt-3 pb-4 rounded shadow"},xt={class:"card-title mb-1"},wt={class:"block text-sm mb-1"},St={class:"h-5 w-full relative"},Tt={class:"absolute inset-x-0 inset-y-0 text-center text-sm text-[#666] dark:text-[#eee] flex items-center justify-center"},Ot={class:"mt-6 grid grid-cols-2"},Pt={class:"bg-base-100 px-4 pt-3 pb-5 rounded shadow lg:!!col-span-2"},Nt={class:"card-title"},$t={class:"px-1"},kt={class:"flex items-center mb-4 mt-2"},Dt=e("div",{class:"w-2 h-2 rounded-full bg-error mr-3"},null,-1),Et={class:"text-base flex-1 text-main"},At={class:"text-sm"},Vt={class:"flex items-center mb-4"},It=e("div",{class:"w-2 h-2 rounded-full bg-primary mr-3"},null,-1),Lt={class:"text-base flex-1 text-main"},Rt={class:"text-sm"},Bt={class:"mb-4"},Ct={class:"flex items-center"},Ut=e("div",{class:"w-2 h-2 rounded-full bg-yes mr-3"},null,-1),jt={class:"text-base flex-1 text-main"},Wt={class:"text-sm"},qt={class:"pl-5 text-sm mt-2"},zt={class:"flex items-center mb-1"},Ft=e("div",{class:"w-2 h-2 rounded-full bg-success mr-3"},null,-1),Ht={class:"text-base flex-1 text-main"},Yt={class:"text-sm"},Gt={class:"pl-5 text-sm"},Jt={key:0,class:"mt-4"},Kt={class:"flex items-center"},Mt=e("div",{class:"w-2 h-2 rounded-full bg-warning mr-3"},null,-1),Qt={class:"text-base flex-1 text-main"},Zt={key:0},Xt={key:1},te={class:"text-sm"},ee={class:"pl-5 text-sm mt-2"},se={class:"bg-base-100 px-4 pt-3 pb-4 rounded mb-4 shadow"},oe={class:"card-title"},ae={class:"overflow-x-auto"},ne={class:"table w-full table-zebra"},le={class:"py-2 text-sm"},ie={key:1,class:"py-2 text-sm"},ve=tt({__name:"[proposal_id]",props:["proposal_id","chain"],setup(O){const b=O,s=S({}),r=et(),f=st(),I=ot(),L=at(),W=nt();f.fetchProposal(b.proposal_id).then(t=>{var l,c,p;const o=lt(t.proposal);((l=t.proposal)==null?void 0:l.status)==="PROPOSAL_STATUS_VOTING_PERIOD"&&f.fetchTally(b.proposal_id).then(u=>{o.final_tally_result=u==null?void 0:u.tally}),s.value=o,(c=o.content)!=null&&c.changes&&((p=o.content)==null||p.changes.forEach(u=>{W.rpc.getParams(u.subspace,u.key).then(h=>{s.value.content&&h.param&&(s.value.content.current?s.value.content.current.push(h.param):s.value.content.current=[h.param])})}))});const R=d(()=>s.value.status==="PROPOSAL_STATUS_PASSED"?"success":s.value.status==="PROPOSAL_STATUS_REJECTED"?"error":""),q=d(()=>s.value.status?s.value.status.replace("PROPOSAL_STATUS_",""):""),z=S({});f.fetchProposalDeposits(b.proposal_id).then(t=>z.value=t);const D=S({}),E=S(new it),A=S({});f.fetchProposalVotes(b.proposal_id).then(t=>{D.value=t.votes,A.value=t.pagination});function g(t){return t?r.toDay(t,"from"):""}const F=d(()=>{const t=new Date;return new Date(s.value.voting_end_time).getTime()-t.getTime()}),H=d(()=>{var c,p,u,h,y,x,w;const t=Number(((p=(c=s.value.content)==null?void 0:c.plan)==null?void 0:p.height)||0);if(t>0){const P=ct(),n=Number(((y=(h=(u=P.latest)==null?void 0:u.block)==null?void 0:h.header)==null?void 0:y.height)||0);return(t-n)*6*1e3}const o=new Date;return new Date(((w=(x=s.value.content)==null?void 0:x.plan)==null?void 0:w.time)||"").getTime()-o.getTime()}),m=d(()=>{const t=s.value.final_tally_result;let o=0;return t&&(o+=Number(t.abstain||0),o+=Number(t.yes||0),o+=Number(t.no||0),o+=Number(t.no_with_veto||0)),o}),Y=d(()=>{var t;if(m.value>0){const o=((t=L.pool)==null?void 0:t.bonded_tokens)||"1";return r.percent(m.value/Number(o))}return 0}),G=d(()=>{var t,o;if(m.value>0){const l=((o=(t=s.value)==null?void 0:t.final_tally_result)==null?void 0:o.yes)||0;return r.percent(Number(l)/m.value)}return 0}),J=d(()=>{var t,o;if(m.value>0){const l=((o=(t=s.value)==null?void 0:t.final_tally_result)==null?void 0:o.no)||0;return r.percent(Number(l)/m.value)}return 0}),K=d(()=>{var t,o;if(m.value>0){const l=((o=(t=s.value)==null?void 0:t.final_tally_result)==null?void 0:o.no_with_veto)||0;return r.percent(Number(l)/m.value)}return 0}),M=d(()=>{var t,o;if(m.value>0){const l=((o=(t=s.value)==null?void 0:t.final_tally_result)==null?void 0:o.abstain)||0;return r.percent(Number(l)/m.value)}return 0}),Q=d(()=>[{name:"Turnout",value:Y.value,class:"bg-info"},{name:"Yes",value:G.value,class:"bg-success"},{name:"No",value:J.value,class:"bg-error"},{name:"No With Veto",value:K.value,class:"bg-red-800"},{name:"Abstain",value:M.value,class:"bg-warning"}]);function Z(t){const{data:o}=k.fromBech32(t),l=k.toHex(o),c=L.validators.find(p=>k.toHex(k.fromBech32(p.operator_address).data)===l);return c?c.description.moniker:t}function X(t){E.value.setPage(t),f.fetchProposalVotes(b.proposal_id,E.value).then(o=>{D.value=o.votes,A.value=o.pagination})}return(t,o)=>{var l,c,p,u,h,y,x,w,P;return _(),v("div",null,[e("div",mt,[e("h2",pt,[e("p",ht,a(O.proposal_id)+". "+a(s.value.title||((l=s.value.content)==null?void 0:l.title)),1),e("div",{class:N(["badge badge-ghost",i(R)==="success"?"text-yes":i(R)==="error"?"text-no":"text-info"])},a(i(q)),3)]),e("div",bt,[T(dt,{value:s.value.content},null,8,["value"])]),s.value.summary&&!((c=s.value.content)!=null&&c.description)?(_(),v("div",ft,[T(i(_t),{"model-value":i(r).multiLine(s.value.summary),previewOnly:"",class:"md-editor-recover"},null,8,["model-value"])])):$("",!0)]),e("div",gt,[e("div",yt,[e("h2",xt,a(t.$t("gov.tally")),1),(_(!0),v(C,null,U(i(Q),(n,V)=>(_(),v("div",{class:"mb-1",key:V},[e("label",wt,a(n.name),1),e("div",St,[e("div",{class:N(["absolute inset-x-0 inset-y-0 w-full opacity-10 rounded-sm",`${n.class}`])},null,2),e("div",{class:N(["absolute inset-x-0 inset-y-0 rounded-sm",`${n.class}`]),style:rt(`width: ${n.value==="-"||n.value==="NaN%"?"0%":n.value}`)},null,6),e("p",Tt,a(n.value),1)])]))),128)),e("div",Ot,[e("label",{for:"vote",class:"btn btn-primary float-right btn-sm mx-1",onClick:o[0]||(o[0]=n=>i(I).open("vote",{proposal_id:O.proposal_id}))},a(t.$t("gov.btn_vote")),1),e("label",{for:"deposit",class:"btn btn-primary float-right btn-sm mx-1",onClick:o[1]||(o[1]=n=>i(I).open("deposit",{proposal_id:O.proposal_id}))},a(t.$t("gov.btn_deposit")),1)])]),e("div",Pt,[e("h2",Nt,a(t.$t("gov.timeline")),1),e("div",$t,[e("div",kt,[Dt,e("div",Et,a(t.$t("gov.submit_at"))+": "+a(i(r).toDay(s.value.submit_time)),1),e("div",At,a(g(s.value.submit_time)),1)]),e("div",Vt,[It,e("div",Lt,a(t.$t("gov.deposited_at"))+": "+a(i(r).toDay(s.value.status==="PROPOSAL_STATUS_DEPOSIT_PERIOD"?s.value.deposit_end_time:s.value.voting_start_time)),1),e("div",Rt,a(g(s.value.status==="PROPOSAL_STATUS_DEPOSIT_PERIOD"?s.value.deposit_end_time:s.value.voting_start_time)),1)]),e("div",Bt,[e("div",Ct,[Ut,e("div",jt,a(t.$t("gov.vote_start_from"))+" "+a(i(r).toDay(s.value.voting_start_time)),1),e("div",Wt,a(g(s.value.voting_start_time)),1)]),e("div",qt,[T(j,{time:i(F)},null,8,["time"])])]),e("div",null,[e("div",zt,[Ft,e("div",Ht,a(t.$t("gov.vote_end"))+" "+a(i(r).toDay(s.value.voting_end_time)),1),e("div",Yt,a(g(s.value.voting_end_time)),1)]),e("div",Gt,a(t.$t("gov.current_status"))+": "+a(t.$t(`gov.proposal_statuses.${s.value.status}`)),1)]),(h=(u=(p=s.value)==null?void 0:p.content)==null?void 0:u["@type"])!=null&&h.endsWith("SoftwareUpgradeProposal")?(_(),v("div",Jt,[e("div",Kt,[Mt,e("div",Qt,[ut(a(t.$t("gov.upgrade_plan"))+": ",1),Number(((x=(y=s.value.content)==null?void 0:y.plan)==null?void 0:x.height)||"0")>0?(_(),v("span",Zt," (EST)")):(_(),v("span",Xt,a(i(r).toDay((P=(w=s.value.content)==null?void 0:w.plan)==null?void 0:P.time)),1))]),e("div",te,a(g(s.value.voting_end_time)),1)]),e("div",ee,[T(j,{time:i(H)},null,8,["time"])])])):$("",!0)])])]),e("div",se,[e("h2",oe,a(t.$t("gov.votes")),1),e("div",ae,[e("table",ne,[e("tbody",null,[(_(!0),v(C,null,U(D.value,(n,V)=>(_(),v("tr",{key:V},[e("td",le,a(Z(n.voter)),1),n.option?(_(),v("td",{key:0,class:N(["py-2 text-sm",{"text-yes":n.option==="VOTE_OPTION_YES","text-gray-400":n.option==="VOTE_OPTION_ABSTAIN"}])},a(String(n.option).replace("VOTE_OPTION_","")),3)):$("",!0),n.options?(_(),v("td",ie,a(n.options.map(B=>`${B.option.replace("VOTE_OPTION_","")}:${i(r).percent(B.weight)}`).join(", ")),1)):$("",!0)]))),128))])]),T(vt,{limit:E.value.limit,total:A.value.total,callback:X},null,8,["limit","total"])])])])}}});export{ve as default};

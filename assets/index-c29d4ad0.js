import{d as U,Y,K as G,I as Q,a2 as X,m as Z,$ as tt,j as _,l as et,a1 as O,r as st,o as p,n as v,p as t,M as y,q as i,S as k,t as o,al as at,L as g,F as ot,s as nt,y as $,f as it,O as lt}from"./index-81fd55b5.js";import{b as F}from"./route-block-83d24a4e.js";const rt={class:"bg-base-100 rounded-lg grid sm:grid-cols-1 md:grid-cols-4 p-4"},ct={class:"flex"},dt={class:"relative w-9 h-9 rounded overflow-hidden flex items-center justify-center mr-2"},ut=t("div",{class:"absolute top-0 left-0 bottom-0 right-0 opacity-20 bg-success"},null,-1),ht={class:"font-bold"},pt={class:"text-xs"},_t={class:"flex"},vt={class:"relative w-9 h-9 rounded overflow-hidden flex items-center justify-center mr-2"},gt=t("div",{class:"absolute top-0 left-0 bottom-0 right-0 opacity-20 bg-primary"},null,-1),mt={class:"font-bold"},ft={class:"text-xs"},bt={class:"flex"},xt={class:"relative w-9 h-9 rounded overflow-hidden flex items-center justify-center mr-2"},yt=t("div",{class:"absolute top-0 left-0 bottom-0 right-0 opacity-20 bg-error"},null,-1),kt={class:"font-bold"},wt={class:"text-xs"},$t={class:"flex"},St={class:"relative w-9 h-9 rounded overflow-hidden flex items-center justify-center mr-2"},Ct=t("div",{class:"absolute top-0 left-0 bottom-0 right-0 opacity-20 bg-error"},null,-1),jt={class:"font-bold"},Nt={class:"text-xs"},zt={class:"flex items-center justify-between py-1"},It={class:"tabs tabs-boxed bg-transparent"},Lt={class:"text-lg font-semibold"},Bt={class:"bg-base-100 px-4 pt-3 pb-4 rounded shadow"},Vt={class:"overflow-x-auto"},Pt={class:"table staking-table w-full"},Et={scope:"col",class:"uppercase",style:{width:"3rem",position:"relative"}},Ot={scope:"col",class:"uppercase"},Ft={scope:"col",class:"text-right uppercase"},Rt={scope:"col",class:"text-right uppercase"},Tt={scope:"col",class:"text-right uppercase"},At={scope:"col",class:"text-center uppercase"},Mt={class:"flex items-center overflow-hidden",style:{"max-width":"300px"}},Dt={class:"avatar mr-4 relative w-8 h-8 rounded-full overflow-hidden"},Jt=t("div",{class:"w-8 h-8 rounded-full bg-gray-400 absolute opacity-10"},null,-1),Wt={class:"w-8 h-8 rounded-full"},qt=["src"],Ht={class:"flex flex-col"},Kt={class:"text-sm text-primary dark:invert whitespace-nowrap overflow-hidden"},Ut={class:"text-xs"},Yt={class:"text-right"},Gt={class:"flex flex-col"},Qt={class:"text-sm font-weight-medium whitespace-nowrap"},Xt={class:"text-xs"},Zt={class:"text-right text-xs"},te={class:"text-center"},ee={key:0,class:"badge badge-error gap-2 text-white"},se=["onClick"],ae=t("div",{class:"divider"},null,-1),oe={class:"flex flex-row items-center"},ne={class:"text-xs truncate relative py-2 px-4 rounded-md w-fit text-error mr-2"},ie=t("span",{class:"inset-x-0 inset-y-0 opacity-10 absolute bg-error"},null,-1),le={class:"text-xs truncate relative py-2 px-4 rounded-md w-fit text-warning"},re=t("span",{class:"inset-x-0 inset-y-0 opacity-10 absolute bg-warning"},null,-1),ce={class:"text-xs hidden md:!block pl-2"},de=U({__name:"index",setup(ue){const r=Y(),S=G(),h=Q(),R=X(),I=Z(),T=tt(),A=JSON.parse(localStorage.getItem("avatars")||"{}"),m=_(A||{}),C=_({}),L=_({}),u=_("active"),f=_([]),j=_({});et(()=>{r.fetchUnbondingValdiators().then(e=>{f.value=e.concat(f.value)}),r.fetchInacitveValdiators().then(e=>{f.value=f.value.concat(e)}),I.rpc.getSlashingParams().then(e=>{j.value=e.params})});async function M(){var l,n,a;let e=0,s=Number(((a=(n=(l=S.latest)==null?void 0:l.block)==null?void 0:n.header)==null?void 0:a.height)||0);for(s>14400?s-=14400:s=1;e<r.validators.length&&s>0;)await S.fetchValidatorByHeight(s,e).then(c=>{c.validators.forEach(d=>{L.value[d.pub_key.key]=Number(d.voting_power)})}),e+=100;for(e=0;e<r.validators.length;)await S.fetchLatestValidators(e).then(c=>{c.validators.forEach(d=>{C.value[d.pub_key.key]=Number(d.voting_power)})}),e+=100}const D=O(()=>{const e={};return Object.keys(C.value).forEach(s=>{const l=C.value[s]||0,n=L.value[s]||0;e[s]=l-n}),e}),B=e=>{const s=e.key;return D.value[s]},J=e=>{if(!e)return"";const s=B(e);return s&&s!==0?h.showChanges(s):""},W=e=>{if(!e)return"";const s=B(e);if(s>0)return"text-success";if(s<0)return"text-error"},q=function(e){var n;let s=0;for(let a=0;a<e;a++)s+=Number((n=r.validators[a])==null?void 0:n.delegator_shares);const l=s/r.totalPower;switch(!0){case(u.value==="active"&&l<.33):return"error";case(u.value==="active"&&l<.67):return"warning";default:return"primary"}};function H(e,s){return!e||!s?!1:e.findIndex(l=>{var n,a,c;return s.website&&((a=s.website)==null?void 0:a.substring(0,(n=s.website)==null?void 0:n.lastIndexOf(".")).endsWith(l))||((c=s==null?void 0:s.moniker)==null?void 0:c.toLowerCase().search(l.toLowerCase()))>-1})>-1}const V=O(()=>{var e,s,l;if(u.value==="active")return r.validators.map((n,a)=>({v:n,rank:q(a),logo:N(n.description.identity)}));if(u.value==="featured"){const n=(l=(s=(e=I.current)==null?void 0:e.endpoints)==null?void 0:s.rest)==null?void 0:l.map(a=>a.provider);return n?(n.push("ping"),r.validators.filter(a=>H(n,a.description)).map((a,c)=>({v:a,rank:"primary",logo:N(a.description.identity)}))):[]}return f.value.map((n,a)=>({v:n,rank:"primary",logo:N(n.description.identity)}))}),K=()=>{let e=Promise.resolve();r.validators.forEach(s=>{e=e.then(()=>new Promise(l=>{var a;const n=(a=s.description)==null?void 0:a.identity;n&&!m.value[n]?r.keybase(n).then(c=>{var d,w,b;if(Array.isArray(c.them)&&c.them.length>0){const x=String((b=(w=(d=c.them[0])==null?void 0:d.pictures)==null?void 0:w.primary)==null?void 0:b.url).replace("https://s3.amazonaws.com/keybase_processed_uploads/","");x&&(m.value[n]=x,localStorage.setItem("avatars",JSON.stringify(m.value)))}l()}):l()}))})},N=e=>{if(!e||!m.value[e])return"";const s=m.value[e]||"";return s.startsWith("http")?s:`https://s3.amazonaws.com/keybase_processed_uploads/${s}`};return M(),K(),(e,s)=>{var n;const l=st("RouterLink");return p(),v("div",null,[t("div",rt,[t("div",ct,[t("span",null,[t("div",dt,[y(i(k),{class:"text-success",icon:"mdi:trending-up",size:"32"}),ut])]),t("span",null,[t("div",ht,o(i(h).percent(i(T).inflation)),1),t("div",pt,o(e.$t("staking.inflation")),1)])]),t("div",_t,[t("span",null,[t("div",vt,[y(i(k),{class:"text-primary",icon:"mdi:lock-open-outline",size:"32"}),gt])]),t("span",null,[t("div",mt,o(i(at)((n=i(r).params)==null?void 0:n.unbonding_time)),1),t("div",ft,o(e.$t("staking.unbonding_time")),1)])]),t("div",bt,[t("span",null,[t("div",xt,[y(i(k),{class:"text-error",icon:"mdi:alert-octagon-outline",size:"32"}),yt])]),t("span",null,[t("div",kt,o(i(h).percent(j.value.slash_fraction_double_sign)),1),t("div",wt,o(e.$t("staking.double_sign_slashing")),1)])]),t("div",$t,[t("span",null,[t("div",St,[y(i(k),{class:"text-error",icon:"mdi:pause",size:"32"}),Ct])]),t("span",null,[t("div",jt,o(i(h).percent(j.value.slash_fraction_downtime)),1),t("div",Nt,o(e.$t("staking.downtime_slashing")),1)])])]),t("div",null,[t("div",zt,[t("div",It,[t("a",{class:g(["tab text-gray-400",{"tab-active":u.value==="featured"}]),onClick:s[0]||(s[0]=a=>u.value="featured")},o(e.$t("staking.popular")),3),t("a",{class:g(["tab text-gray-400",{"tab-active":u.value==="active"}]),onClick:s[1]||(s[1]=a=>u.value="active")},o(e.$t("staking.active")),3),t("a",{class:g(["tab text-gray-400",{"tab-active":u.value==="inactive"}]),onClick:s[2]||(s[2]=a=>u.value="inactive")},o(e.$t("staking.inactive")),3)]),t("div",Lt,o(i(V).length)+"/"+o(i(r).params.max_validators),1)]),t("div",Bt,[t("div",Vt,[t("table",Pt,[t("thead",null,[t("tr",null,[t("th",Et,o(e.$t("staking.rank")),1),t("th",Ot,o(e.$t("staking.validator")),1),t("th",Ft,o(e.$t("staking.voting_power")),1),t("th",Rt,o(e.$t("staking.24h_changes")),1),t("th",Tt,o(e.$t("staking.commission")),1),t("th",At,o(e.$t("staking.actions")),1)])]),t("tbody",null,[(p(!0),v(ot,null,nt(i(V),({v:a,rank:c,logo:d},w)=>{var b,x,P,E;return p(),v("tr",{key:a.operator_address,class:"hover:bg-gray-100 dark:hover:bg-[#384059]"},[t("td",null,[t("div",{class:g(["text-xs truncate relative px-2 py-1 rounded-full w-fit",`text-${c}`])},[t("span",{class:g(["inset-x-0 inset-y-0 opacity-10 absolute",`bg-${c}`])},null,2),$(" "+o(w+1),1)],2)]),t("td",null,[t("div",Mt,[t("div",Dt,[Jt,t("div",Wt,[d?(p(),v("img",{key:0,src:d,class:"object-contain"},null,8,qt)):(p(),it(i(k),{key:1,class:"text-4xl",icon:"mdi-help-circle-outline"}))])]),t("div",Ht,[t("span",Kt,[y(l,{to:{name:"chain-staking-validator",params:{validator:a.operator_address}},class:"font-weight-medium"},{default:lt(()=>{var z;return[$(o((z=a.description)==null?void 0:z.moniker),1)]}),_:2},1032,["to"])]),t("span",Ut,o(((b=a.description)==null?void 0:b.website)||((x=a.description)==null?void 0:x.identity)||"-"),1)])])]),t("td",Yt,[t("div",Gt,[t("h6",Qt,o(i(h).formatToken({amount:parseInt(a.tokens).toString(),denom:i(r).params.bond_denom},!0,"0,0")),1),t("span",Xt,o(i(h).calculatePercent(a.delegator_shares,i(r).totalPower)),1)])]),t("td",{class:g(["text-right text-xs",W(a.consensus_pubkey)])},o(J(a.consensus_pubkey)),3),t("td",Zt,o(i(h).formatCommissionRate((E=(P=a.commission)==null?void 0:P.commission_rates)==null?void 0:E.rate)),1),t("td",te,[a.jailed?(p(),v("div",ee,o(e.$t("staking.jailed")),1)):(p(),v("label",{key:1,for:"delegate",class:"btn btn-xs btn-primary rounded-sm capitalize",onClick:z=>i(R).open("delegate",{validator_address:a.operator_address})},o(e.$t("account.btn_delegate")),9,se))])])}),128))])])]),ae,t("div",oe,[t("div",ne,[ie,$(" "+o(e.$t("staking.top"))+" 33% ",1)]),t("div",le,[re,$(" "+o(e.$t("staking.top"))+" 67% ",1)]),t("div",ce,o(e.$t("staking.description")),1)])])])])}}});typeof F=="function"&&F(de);export{de as default};
